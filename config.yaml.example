# ================= 基础配置 =================
# APP_NAME: 应用名称
APP_NAME: TrendSonar
# LOG_LEVEL: 日志等级: DEBUG, INFO, WARNING, ERROR
LOG_LEVEL: INFO
# PORT: 服务端口
PORT: 8193

# ================= 数据库配置 =================
# 格式: postgresql+asyncpg://用户名:密码@主机地址:端口/数据库名
# DATABASE_URL: postgresql+asyncpg://Postgres_username:Postgres_userpasswd@postgres_db:5432/postgres_dbname
# 如果是sqlite数据库，使用下方的配置
DATABASE_URL: sqlite+aiosqlite:///data/trendsonar.db

# ================= 爬虫服务配置 =================
# 微博 Cookie（用于登录微博，获取更多内容）
# 从浏览器复制完整的 Cookie 字符串，包含所有必要的会话信息，如果抓取微博详情内容失效，请更新
WEIBO_COOKIE: "Example:JAHKSJDHKASDHKJ……"

# ================= AI 模型配置 =================
# --- Embedding & Rerank (SiliconFlow) ---
# 用于计算向量相似度和重排序（推荐免费的 硅基流动的 BAAI/bge-m3）
# 注册硅基流动：https://cloud.siliconflow.cn/i/fUoGwjZb
SILICONFLOW_API_KEY: sk-XXXXXXXXXXXXXXXXXXXX
SILICONFLOW_BASE_URL: https://api.siliconflow.cn/v1
EMBEDDING_MODEL: BAAI/bge-m3

# --- 主力生成模型 ---
# 用于生成新闻摘要 (推荐免费的智谱 glm-4-flash)
MAIN_AI_API_KEY: XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
MAIN_AI_BASE_URL: https://open.bigmodel.cn/api/paas/v4
MAIN_AI_MODEL: glm-4-flash
MAIN_AI_CONCURRENCY: 10  # 最大并发请求数，根据模型能力调整

# --- 备用生成模型 ---
# 当主力模型失败时自动切换，聚类去重优先使用此模型（推荐deepseek）
BACKUP_AI_API_KEY: sk-XXXXXXXXXXXXXXXXXXXXXXXXXXX
BACKUP_AI_BASE_URL: https://api.xiaomimimo.com/v1
BACKUP_AI_MODEL: mimo-v2-flash
BACKUP_AI_CONCURRENCY: 5  # 最大并发请求数，根据模型能力调整

# ================= AI 路由配置 =================
# 配置不同功能模块使用的 AI 节点 (main / backup)
# main: 使用主力生成模型
# backup: 使用备用生成模型

AI_ROUTE:
  # --- 基础分析 ---
  SUMMARY: "main"      # 新闻摘要生成
  SENTIMENT: "main"    # 情感倾向分析
  KEYWORDS: "main"     # 关键词与实体提取
  CLUSTERING: "backup"   # 新闻聚类去重 (判断两条新闻是否同一事件)

  # --- 专题追踪 ---
  TOPIC_NAME: "backup"     # 专题命名
  TOPIC_EVAL: "backup"     # 专题质量评估 (宽泛过滤/查重/延伸判断)
  TOPIC_MATCH: "backup"    # 专题匹配核验 (判断新闻是否属于专题)
  TOPIC_TIMELINE: "backup" # 时间轴事件生成 (高信息密度描述)
  TOPIC_OVERVIEW: "backup" # 专题综述生成 (深度分析)
  # --- 报表生成 ---
  REPORT: "backup"         # 日报/周报生成
  # --- 交互对话 ---
  CHAT: "backup"           # 实时问答/助手对话

# ================= 算法调优参数 =================
# 聚类相似度阈值 (0.0 - 1.0)，建议 0.75，越高越严格
CLUSTERING_THRESHOLD: 0.72
# 聚类时间窗口 (小时)，超过此时间差的新闻即使相似也不合并
CLUSTERING_TIME_WINDOW_HOURS: 18
# 自动任务调度间隔 (分钟)
SCHEDULE_INTERVAL_MINUTES: 30
# 自动摘要 Top N (为每日热度最高的 N 条新闻生成摘要)
AUTO_SUMMARY_TOP_N: 60
# 自动深度分析 Top N (为每日热度最高的 N 条新闻自动分类、情感分析)
AUTO_ANALYSIS_TOP_N: 200
# 分析批次大小 (建议 10-50)，受AI模型的上下文长度和性能限制，建议根据模型能力调整
ANALYSIS_BATCH_SIZE: 10

# ================= 其他配置 =================
# 管理员密码（仅此项保留在 .env，优先从 .env / 环境变量读取）
# ADMIN_PASSWORD: "admin888"

# 关注关键词 (逗号分隔，为空则不过滤，示例："中国, 美国, 北京"）
FOLLOW_KEYWORDS: ""
# 关注关键词相似度阈值 (0.0 - 1.0)，建议 0.5，越高越严格
FOLLOW_KEYWORDS_THRESHOLD: 0.5

# 新闻分类
NEWS_CATEGORIES:
  - 时政军事
  - 财经商业
  - 科技科学
  - 社会民生
  - 文娱体育

# 忽略域名列表（命中则不抓取/不入库，示例：["weibo.com", "twitter.com"]）
IGNORED_DOMAINS: []

# ================= 专题追踪配置 =================
# 聚合时间窗口（天）：从最近 N 天的新闻中提炼 (默认 3)
TOPIC_LOOKBACK_DAYS: 7
# 聚合种子数：从最近 N 天热度最高的 X 条未归类新闻中提炼专题 (默认 300)
TOPIC_AGGREGATION_TOP_N: 300
# 每次生成的新专题数量范围 (min-max)，格式 "3-10"
TOPIC_GENERATION_COUNT: "1-5"
# 向量召回池大小：在最近 N 条新闻中进行向量搜索 (默认 2000)
TOPIC_RECALL_POOL_SIZE: 3000
# 向量初筛阈值（0.0-1.0）：用于向量预筛候选新闻 (默认 0.6)
TOPIC_MATCH_THRESHOLD: 0.6
# 向量召回候选数：每个专题最多对前 N 条高相似度新闻进行 AI 核验 (默认 20)
TOPIC_MATCH_MAX_CANDIDATES: 30
# 专题质量门槛：只有当核验通过的新闻数量 > N 时才创建专题 (默认 3)
TOPIC_MIN_NEWS_COUNT: 3
# 专题定时任务间隔（小时）
TOPIC_SCHEDULE_INTERVAL_HOURS: 4
